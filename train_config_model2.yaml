# 火点检测YOLO训练配置文件
# 支持负样本（空标签文件）的训练，专门用于smoke和fire检测

# 模型配置
model:
  # 模型类型: yolo11n, yolo11s, yolo11m, yolo11l, yolo11x, yolo12n, yolo12s, yolo12m, yolo12l, yolo12x
  name: "yolo11x"  # 使用中等大小的模型，适合火点检测

  # 预训练权重路径 (可选)
  # pretrained: ""  # 留空表示使用官方预训练权重

# 训练参数配置 - 针对火点检测优化
training:
  # 基础训练参数
  epochs: 100                    # 训练轮次
  batch_size: 24                 # 批次大小
  image_size: 640                # 图像尺寸 (火点检测不需要特别大的尺寸)
  learning_rate: 0.01            # 初始学习率
  device: "0,1,2"                # 设备: "0"(GPU), "1"(GPU), "cpu" 或 "0,1"(多GPU)
  workers: 8                     # 数据加载线程数

  # 学习率参数
  lrf: 0.01                      # 最终学习率 = lr0 * lrf
  momentum: 0.937                # SGD momentum
  weight_decay: 0.0005           # 权重衰减

  # 预热参数
  warmup_epochs: 3.0             # 预热轮次
  warmup_momentum: 0.8           # 预热期初始momentum
  warmup_bias_lr: 0.1            # 预热期偏置学习率

  # 损失函数权重 - 针对火点检测优化
  box_loss_gain: 7.5             # 边界框损失权重
  cls_loss_gain: 0.5             # 分类损失权重
  obj_loss_gain: 1.0             # 目标检测损失权重
  obj_positive_weight: 1.0       # 目标检测正样本权重

  # IoU和阈值参数
  iou_threshold: 0.2             # IoU训练阈值
  anchor_threshold: 4.0          # 锚点阈值

  # 其他训练参数
  save_period: 20                # 每隔多少轮保存一次检查点
  cache: "ram"                   # 数据缓存: "ram", "disk", 或 False
  exist_ok: false                # 是否覆盖已存在的实验目录
  resume: false                  # 是否恢复训练
  verbose: true                  # 详细输出
  evaluate: true                 # 训练后评估模型

  # 实验名称
  experiment_name: "fire_detection_negative_samples"

  # 优化器和调度器参数
  optimizer: "SGD"               # 优化器: SGD通常对火点检测效果更好
  patience: 50                   # 早停耐心值
  plots: true                    # 是否生成训练图表
  rect: true                     # 使用矩形训练 (节省显存)

  # 模型保存参数
  save_json: false               # 是否保存COCO格式的评估结果
  save_hybrid: false             # 是否保存混合版本标签

  # 验证参数
  val: true                      # 是否在训练期间验证
  val_conf_threshold: 0.25       # 验证时的置信度阈值
  val_iou_threshold: 0.45        # 验证时的IoU阈值

  # 传输学习参数
  freeze: false                  # 是否冻结层 (可以是数字或层名称)
  multi_scale: true              # 启用多尺度训练 (对火点检测很重要)

# 数据增强配置 - 针对火点检测优化
augmentation:
  # HSV增强 (火点检测专用)
  hsv_h: 0.015                   # 色调增强范围 (火点色调变化较小)
  hsv_s: 0.7                     # 饱和度增强范围
  hsv_v: 0.4                     # 明度增强范围 (对火点检测重要)

  # 几何变换
  degrees: 10.0                  # 旋转角度范围 (火点检测可接受更大旋转)
  translate: 0.1                 # 平移范围
  scale: 0.5                     # 缩放范围
  shear: 0.0                     # 剪切角度范围
  perspective: 0.0               # 透视变换范围

  # 翻转
  flipud: 0.5                    # 上下翻转概率
  fliplr: 0.5                    # 左右翻转概率

  # 混合增强
  mosaic: 1.0                    # Mosaic增强概率
  mixup: 0.0                     # Mixup增强概率 (火点检测不建议使用mixup)

# 类别特定强化参数 - 针对smoke和fire检测
# 类别ID从0开始，0=smoke, 1=fire
class_specific:
  # 类别0 (smoke) - 烟雾检测
  0:
    # 损失权重增强
    loss_weight: 1.2             # 适度增加烟雾检测权重

    # 数据增强强度倍数
    augmentation_scale: 1.0      # 正常增强

    # 最小样本权重
    min_samples_weight: 1.0      # 正常权重

    # 学习率倍数
    lr_multiplier: 1.0           # 正常学习率

  # 类别1 (fire) - 火焰检测
  1:
    # 损失权重增强
    loss_weight: 1.5             # 增加火焰检测权重

    # 数据增强强度倍数
    augmentation_scale: 1.1      # 轻微增强

    # 最小样本权重
    min_samples_weight: 1.2      # 提高火焰样本权重

    # 学习率倍数
    lr_multiplier: 1.1           # 适度增加学习率

# 数据集配置
dataset:
  # 数据集YAML文件路径
  dataset_yaml: "/media/wensiye/nanshan-fire-dataset/nanshan-fire-dataset.yaml"

  # 数据集根目录 (用于验证路径)
  root_path: "/media/wensiye/nanshan-fire-dataset"

  # 负样本处理配置
  negative_samples:
    enabled: true                # 是否启用负样本支持
    auto_create_labels: true     # 是否自动为缺失标签的图像创建空标签文件
    negative_ratio: 0.3          # 负样本比例控制 (可选)

# 高级配置 (可选)
advanced:
  # 多GPU训练参数
  multi_gpu:
    enabled: true                # 是否启用多GPU训练
    sync_bn: true                # 是否使用同步BatchNorm

  # 混合精度训练
  mixed_precision:
    enabled: true                # 是否启用混合精度训练

  # 梯度裁剪
  grad_clip:
    enabled: false               # 是否启用梯度裁剪
    max_norm: 10.0              # 最大梯度范数

  # 早停参数
  early_stopping:
    enabled: false               # 是否启用早停
    patience: 30                 # 容忍轮次
    min_delta: 0.001             # 最小改善幅度

  # 负样本特殊处理
  negative_sample_handling:
    # 空标签文件处理策略
    empty_label_strategy: "keep" # "keep"保留, "remove"移除, "synthesize"合成

    # 负样本数据增强
    negative_augmentation:
      enabled: true              # 是否对负样本进行特殊增强
      brightness_range: 0.3      # 亮度变化范围
      contrast_range: 0.2        # 对比度变化范围

    # 负样本采样策略
    sampling_strategy: "uniform" # "uniform"均匀, "weighted"加权